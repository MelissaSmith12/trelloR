---
title: "R API for Trello"
author: "Jakub Chromec"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
library(httr)
knitr::opts_chunk$set(comment = "#>", collapse = TRUE)
```

This document explains how to GET public and private data from Trello boards using `trellor`.

Disclaimer: `trellor` is not affiliated, associated, authorized, endorsed by or in any way officially connected to Trello, Inc. (www.trello.com).

Getting public data
-------------------

`trellor` allows you to GET data from specific levels of Trello's JSON hierarchy. Other requests (such as POST or PUT) are not implemented right now. Getting data from private boards requires a secure token, which you can read about in the **Getting private data** section.

In order to get data from a specific endpoint (like "board" or "card"), you need to have either its ID or the ID of its parent structure. Here is an example of getting ID of Trello Development Roadmap (public board) and using it to fetch a list of cards:

```r
url   = "https://trello.com/b/nC8QJJoZ/trello-development-roadmap"
bid   = trellor::get_id_board(url)
cards = trellor::get_board_cards(bid)
```

The incomming JSON data is by default formatted into a *flat* `data.frame`, so you don't have to worry about formatting the response. It will have multiple columns including card ID, name, description and more. Card ID can be used for further queries, such as getting all the members from a particular card:

```r
card_id = cards$id[1]
cards   = trellor::get_card_members(card_id)
```

The naming scheme is pretty consistent. The prefix `get_` is followed by parent level, e.g. `board_` which is followed by child level, e.g. `card`. Thus it is easy to guess a function name. For complete list of available functions see `?get_board` and `?get_card`.

###`get_` function builder
If you lack a particular `get_` function, you can create one using the function builder `trello_req()`. Just decide which parent and child levels you want to fetch. Optionally set a filter value. You can then build your own data fetching function like this:

```{r}
fetch_card_updates = trellor::trello_req(parent = "card", child  = "actions", 
                                         filter = "updateCard")
```

Since we want to get data from a card, the `"card"` is the `parent`. Card updates are a type of action, so `"actions"` is the `child`. Without the `filter` specification, all the actions would be returned, not only card updates (indeed, that is what the existing `get_card_actions()` already does).

You can then call your custom function in a usual way, supplying card ID:

```r
card_updates = fetch_card_updates(card_id)
```

###Additional arguments
The `get_` functions are designed to eliminate the effort when building and reusing URL requests. Typically, you just specify resource ID in the function call, and that's it.

However, you have multiple other arguments at your disposal. Let's look at the function we created in the previous section:

```{r}
fetch_card_updates
```

As you can see, there is a handful of optional arguments. They'll be passed to the `trello_get()` function which is called after the URL is build and handles all the GET requests.

You can supply a 

* `token` (see the Auhtorization section), 
* `limit` in case you are not happy with the default limit of 1000 results, which is also the maximum value. 
* You can also specify custom `query` by providing a list of key-value pairs, such as `query = list(key1 = "value1", key2 = "value2")`. Read `?httr::GET` for details. Setting `filter = "updateCard` and `limit=10` is the equivalent of `query = list(filter = "updateCard", limit = 10)`. If you need more info about what keys and values are available for the query prameters, visit the [Trello API reference page](https://developers.trello.com/advanced-reference).
* You can also activate `paging` which is useful for requests returning more than 1000 results. It basically breaks the request down into smaller pieces, each returning no more than 1000 results.
* `bind.rows` can be quite useful as it binds all the results into single `data.frame`. If `bind.rows = FALSE`, the result will be a `list` with as many elements as there were pages. This can also come handy on the rare occasion when the responses are not perfectly formatted and make `dplyr::bind_rows` fail.

When calling `trello_get()` you can also specify `filter` directly (without the need to set it in the `trello_req()` call). But you have to specify the whole request URL by hand.

Getting private data
----------------------

Access to private boards requires authorization. This process includes creation of an "app" which uses a secure token to communicate with Trello API, and will allow you to retrieve data from private boards (provided you have the right to access them).

To create a token, **login** to Trello and visit the [Developer Start Page](https://developers.trello.com/get-started/start-building#connect). There you can get your developer credentials, i.e. your "key" and "secret". Then, call the `trello_get_token()` function to create a token for your project. This will also trigger first-time authorization in the browser (you only have to do it once):

```r
my_token = trellor::trello_get_token(your_key, your_secret)
```

You will also be offered an option to store the authentication data in your working directory, in a hidden `'.httr-oauth'` file.

**NOTE.** Make sure you keep your credentials in a **safe, non-shared** location.

###Using the token to retrieve private data

One thing you can do immediately after obtaining a token is to get an overview of all your boards, by the `get_my_boards()` function. It accepts the token as its only argument and returns a `data.frame` with board names and IDs related to the user who authorize the app.

Next, you can just use the `get_` functions to retrieve data as before, supplying the token as the named argument (`token = your_token`).

#####Build with

```{r}
sessionInfo()
```
